# üß™ Guide Unifi√© des Tests - MangeTaMain

## üéØ Vue d'ensemble

Ce guide pr√©sente le syst√®me de tests unifi√© de MangeTaMain, con√ßu pour offrir une exp√©rience coh√©rente sur tous les environnements (Docker, Python direct, Windows, Linux, macOS).

### ‚ú® Fonctionnalit√©s du syst√®me de tests

- üöÄ **Script unifi√©** : Un seul point d'entr√©e pour tous les tests
- üê≥ **Docker + Python** : Support automatique Docker Compose et Python direct
- üåç **Multi-plateforme** : Windows, Linux, macOS avec auto-d√©tection
- üìä **Couverture 80%+** : Suite compl√®te avec rapports d√©taill√©s
- üîß **Mode d√©veloppement** : Environnement interactif pour debugging
- üßπ **Nettoyage automatique** : Gestion propre des ressources Docker

## üöÄ Utilisation Rapide

### Commande Simple
```bash
# Auto-d√©tection de l'environnement optimal
./run_tests_unified.py

# Ou directement avec Python
python run_tests_unified.py
```

### Tests Sp√©cifiques
```bash
# Tests unitaires seulement
./run_tests_unified.py -u

# Tests d'int√©gration seulement  
./run_tests_unified.py -i

# Tests de performance seulement
./run_tests_unified.py -p

# V√©rification couverture existante
./run_tests_unified.py -c
```

### Modes Avanc√©s
```bash
# Mode d√©veloppement interactif (Docker)
./run_tests_unified.py -d

# Forcer utilisation Docker
./run_tests_unified.py --docker

# Forcer utilisation Python direct
./run_tests_unified.py --python

# Tests avec reconstruction des images
./run_tests_unified.py -u -b

# Mode verbose avec marqueurs
./run_tests_unified.py -v -m "unit and not slow"

# Nettoyer environnement Docker
./run_tests_unified.py --clean
```

## üèóÔ∏è Architecture des Tests

### Structure Unifi√©e
```
tests/
‚îú‚îÄ‚îÄ unit/                          # Tests unitaires (rapides)
‚îÇ   ‚îú‚îÄ‚îÄ test_data_load.py         # Tests de chargement Kaggle
‚îÇ   ‚îú‚îÄ‚îÄ test_data_prepro.py       # Tests de preprocessing
‚îÇ   ‚îî‚îÄ‚îÄ test_reco_score.py        # Tests du moteur de recommandation
‚îú‚îÄ‚îÄ integration/                   # Tests d'int√©gration
‚îÇ   ‚îú‚îÄ‚îÄ test_streamlit_app.py     # Tests de l'interface Streamlit
‚îÇ   ‚îî‚îÄ‚îÄ test_full_workflow.py     # Tests du workflow complet
‚îú‚îÄ‚îÄ performance/                   # Tests de performance
‚îÇ   ‚îî‚îÄ‚îÄ test_end_to_end.py        # Tests de charge et benchmarking
‚îî‚îÄ‚îÄ conftest.py                   # Configuration pytest commune
```

### Couverture de Tests
| Module | Couverture Cible | Tests Impl√©ment√©s | Status |
|--------|------------------|-------------------|--------|
| `data_load.py` | 85% | 15+ tests complets | ‚úÖ |
| `data_prepro.py` | 80% | 40+ tests robustes | ‚úÖ |
| `reco_score.py` | 85% | 25+ tests algorithmes | ‚úÖ |
| `app.py` | 75% | 20+ tests UI/UX | ‚úÖ |
| **Total Projet** | **80%+** | **100+ tests** | üéØ |

## üõ†Ô∏è Configuration Multi-Environnement

### Auto-d√©tection Intelligente
Le script unifi√© d√©tecte automatiquement :
- ‚úÖ **Docker disponible** ‚Üí Utilise Docker Compose (isolation maximale)
- ‚úÖ **Python + pytest** ‚Üí Utilise Python direct (plus rapide)
- ‚úÖ **Windows/PowerShell** ‚Üí Adaptation syntaxe commandes
- ‚úÖ **Linux/macOS/Bash** ‚Üí Support natif Unix

### Pr√©requis par Environnement

#### Docker (Recommand√©)
```bash
# V√©rification Docker
docker --version
docker-compose --version

# Ex√©cution avec Docker
./run_tests_unified.py --docker
```

#### Python Direct
```bash
# Installation d√©pendances
pip install pytest pytest-cov coverage

# Ou avec Poetry
poetry install --with dev

# Ex√©cution Python direct
./run_tests_unified.py --python
```

## üéõÔ∏è Options Compl√®tes

### Options de Type de Tests
- `-u, --unit` : Tests unitaires uniquement
- `-i, --integration` : Tests d'int√©gration uniquement  
- `-p, --performance` : Tests de performance uniquement
- `-c, --coverage` : V√©rification couverture existante

### Options d'Environnement
- `--docker` : Forcer l'utilisation de Docker Compose
- `--python` : Forcer l'utilisation de Python direct
- `-d, --dev` : Mode d√©veloppement interactif (Docker)
- `--clean` : Nettoyer l'environnement Docker

### Options de Configuration
- `-v, --verbose` : Mode verbose avec d√©tails
- `-b, --build` : Forcer reconstruction images Docker
- `--no-coverage` : D√©sactiver la mesure de couverture
- `-m, --markers` : Filtrer par marqueurs pytest
- `--durations N` : Afficher les N tests les plus lents

## üìä Rapports et M√©triques

### Rapports de Couverture

#### Docker
```bash
# Les rapports sont dans le volume Docker
docker-compose --profile testing exec tests ls -la /app/test-reports/

# Rapports disponibles:
# - htmlcov/          # Rapport HTML interactif
# - coverage.xml      # Rapport XML pour CI/CD
# - junit.xml         # Rapport JUnit pour int√©gration
```

#### Python Direct
```bash
# Rapports locaux g√©n√©r√©s
ls htmlcov/          # Rapport HTML local
ls coverage.xml      # Rapport XML local

# Ouvrir rapport HTML
# Windows
start htmlcov/index.html
# macOS
open htmlcov/index.html  
# Linux
xdg-open htmlcov/index.html
```

### M√©triques de Performance
Le script mesure et affiche :
- ‚è±Ô∏è **Temps d'ex√©cution** par cat√©gorie de tests
- üìä **Couverture par module** avec d√©tails manquants
- üéØ **Tests les plus lents** (top 10 par d√©faut)
- üíæ **Utilisation m√©moire** Docker (si applicable)

## üîß Mode D√©veloppement

### Mode Interactif
```bash
# Lancement du mode d√©veloppement
./run_tests_unified.py -d

# Dans le container interactif:
poetry run pytest tests/unit/           # Tests unitaires
poetry run pytest tests/integration/    # Tests d'int√©gration  
poetry run pytest --cov=src            # Tests avec couverture
poetry run coverage html               # G√©n√©rer rapport HTML
pytest -k test_specific_function       # Test sp√©cifique
pytest --pdb                          # Debugging avec pdb
exit                                   # Quitter
```

### Debugging Avanc√©
```bash
# Tests avec debugging
./run_tests_unified.py -u -v -m "not slow"

# Tests sp√©cifiques avec output
python -m pytest tests/unit/test_data_prepro.py::TestIngredientPreprocessor -v -s

# Profiling des tests lents
./run_tests_unified.py --durations 20
```

## üßπ Maintenance et Nettoyage

### Nettoyage Automatique
```bash
# Nettoyage complet environnement Docker
./run_tests_unified.py --clean

# Actions effectu√©es:
# - Arr√™t services Docker Compose
# - Suppression containers de test
# - Nettoyage volumes Docker
# - Nettoyage images inutilis√©es
```

### Gestion des Ressources
```bash
# V√©rification utilisation Docker
docker system df

# Nettoyage manuel avanc√©
docker system prune -a --volumes

# Monitoring des ressources pendant tests
docker stats
```

## üåç Compatibilit√© Multi-Plateforme

### Windows
```powershell
# PowerShell
python run_tests_unified.py

# Git Bash (recommand√©)
./run_tests_unified.py

# CMD
python run_tests_unified.py --help
```

### Linux/macOS
```bash
# Bash/Zsh
./run_tests_unified.py

# Make executable si n√©cessaire
chmod +x run_tests_unified.py

# Direct Python
python3 run_tests_unified.py
```

### Wrapper Shell
```bash
# Utilisation du wrapper (auto-d√©tecte python/python3)
./run_tests_unified.sh -u -v
```

## üöÄ Int√©gration CI/CD

### GitHub Actions
```yaml
name: Tests
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: Run Tests
      run: python run_tests_unified.py --python --no-coverage
    - name: Upload Coverage
      uses: codecov/codecov-action@v3
      with:
        file: ./coverage.xml
```

### Configuration Docker Production
```bash
# Profile de test d√©di√©
docker-compose --profile testing up -d

# Int√©gration dans pipeline
./run_tests_unified.py --docker --no-coverage > test_results.log
```

## üìö Exemples d'Usage

### D√©veloppement Quotidien
```bash
# Test rapide avant commit
./run_tests_unified.py -u

# Test complet avant push
./run_tests_unified.py

# Debugging d'un test sp√©cifique
./run_tests_unified.py -d
# Puis dans le container: pytest tests/unit/test_specific.py -v -s --pdb
```

### Validation Release
```bash
# Suite compl√®te avec couverture
./run_tests_unified.py -v

# Tests de performance
./run_tests_unified.py -p --durations 20

# Validation multi-environnement
./run_tests_unified.py --docker  # Test avec Docker
./run_tests_unified.py --python  # Test avec Python direct
```

### Maintenance et Monitoring
```bash
# V√©rification couverture sans ex√©cuter tests
./run_tests_unified.py -c

# Nettoyage p√©riodique
./run_tests_unified.py --clean

# Monitoring performance
./run_tests_unified.py -p > perf_report.log
```

## üÜò D√©pannage

### Probl√®mes Courants

#### Docker non disponible
```bash
# Installer Docker Desktop (Windows/macOS)
# Ou Docker Engine (Linux)

# V√©rifier installation
docker --version
docker-compose --version

# Red√©marrer si n√©cessaire
docker-compose --profile testing down
./run_tests_unified.py --clean
```

#### Python/pytest manquant
```bash
# Installation via pip
pip install pytest pytest-cov coverage

# Installation via Poetry
poetry install --with dev

# V√©rification
python -m pytest --version
```

#### Erreurs de permissions (Linux/macOS)
```bash
# Rendre ex√©cutable
chmod +x run_tests_unified.py run_tests_unified.sh

# Ou utilisation directe Python
python run_tests_unified.py
```

#### Probl√®mes de m√©moire
```bash
# Limiter les tests
./run_tests_unified.py -u  # Seulement unitaires

# Augmenter m√©moire Docker
# Docker Desktop ‚Üí Settings ‚Üí Resources ‚Üí Memory
```

### Logs de Debug
```bash
# Mode verbose maximal
./run_tests_unified.py -v --durations 50

# Logs Docker
docker-compose --profile testing logs tests

# Diagnostic environnement
./run_tests_unified.py --help
python --version
docker --version
```

## ‚úÖ Checklist de Validation

### Avant Commit
- [ ] `./run_tests_unified.py -u` passe (tests unitaires)
- [ ] Code format√© et linted
- [ ] Pas de nouvelles d√©pendances non document√©es

### Avant Push
- [ ] `./run_tests_unified.py` passe (tous tests)
- [ ] Couverture ‚â• 80%
- [ ] Tests de performance OK
- [ ] Documentation mise √† jour

### Avant Release
- [ ] Tests multi-environnement (Docker + Python)
- [ ] Tests de performance valid√©s
- [ ] Documentation compl√®te
- [ ] Nettoyage environnement test (`--clean`)

---

## üìû Support

Pour toute question sur les tests :
- üìñ Consultez ce guide complet
- üêõ Ouvrez une issue GitHub si probl√®me persistant  
- üí¨ Utilisez `./run_tests_unified.py --help` pour aide contextuelle

**üéØ Objectif atteint : Syst√®me de tests unifi√© et coh√©rent pour MangeTaMain !**